# 测试文档

## 1. 测试目标
本测试文档旨在验证 `LianjiaRentSpider.py` 和 `Data_Visualization.py` 的功能是否符合设计需求，确保系统的稳定性、准确性和可用性。测试将覆盖数据爬取、数据存储、数据分析和数据可视化等模块。

## 2. 测试环境

### 2.1 硬件环境
- 操作系统：Windows 11
- 处理器：Intel Core i5 或更高
- 内存：8GB 或更高
- 硬盘空间：至少 100MB 可用空间

## 3. 测试策略

### 3.1 单元测试
- 对每个模块的关键函数进行单独测试，验证其功能是否符合预期。
- 使用 Python 的 `unittest` 框架编写单元测试用例。

### 3.2 集成测试
- 测试模块之间的交互是否正常，例如爬虫模块与数据库模块的交互，数据库模块与数据分析模块的交互。
- 验证数据在模块之间的传递是否准确无误。

### 3.3 系统测试
- 对整个系统进行测试，验证系统的整体功能是否符合设计需求。
- 包括数据爬取、存储、分析和可视化的全流程测试。

### 3.4 性能测试
- 测试系统在高负载情况下的性能，例如爬取多页数据时的响应时间和资源占用。
- 验证系统是否能够在合理的时间内完成任务。

## 4. 测试用例

### 4.1 数据爬取模块测试

#### 4.1.1 测试用例：验证网页请求功能
- **测试目标**：验证 `get_page_content(url)` 函数是否能够正确请求网页内容。
- **输入**：有效的链家网租房页面 URL（如 `https://sh.lianjia.com/zufang/pg1/`）。
- **预期输出**：返回非空的 HTML 内容。
- **测试步骤**：
  1. 调用 `get_page_content(url)` 函数。
  2. 检查返回值是否为字符串且不为空。
- **测试结果**：
  - 成功：返回非空的 HTML 内容。
  - 失败：返回空内容或抛出异常。

#### 4.1.2 测试用例：验证页面解析功能
- **测试目标**：验证 `parse_page_content(html)` 函数是否能够正确解析 HTML 并提取房源信息。
- **输入**：有效的链家网租房页面 HTML 内容。
- **预期输出**：返回包含房源信息的列表，每条房源信息为一个元组。
- **测试步骤**：
  1. 调用 `parse_page_content(html)` 函数。
  2. 检查返回的列表是否非空。
  3. 验证列表中每条房源信息的字段是否完整。
- **测试结果**：
  - 成功：返回非空列表，且每条房源信息字段完整。
  - 失败：返回空列表或字段缺失。

#### 4.1.3 测试用例：验证数据存储功能
- **测试目标**：验证 `save_to_database(conn, rentals)` 函数是否能够正确将数据存储到数据库。
- **输入**：有效的房源信息列表。
- **预期输出**：数据成功存储到数据库，且无重复数据。
- **测试步骤**：
  1. 调用 `save_to_database(conn, rentals)` 函数。
  2. 查询数据库，检查数据是否正确存储。
  3. 验证数据库中是否存在重复数据。
- **测试结果**：
  - 成功：数据正确存储，无重复数据。
  - 失败：数据未存储或存在重复数据。

### 4.2 数据分析与可视化模块测试

#### 4.2.1 测试用例：验证数据预处理功能
- **测试目标**：验证价格、面积和楼层字段的清洗功能。
- **输入**：包含价格、面积和楼层信息的 DataFrame。
- **预期输出**：清洗后的 DataFrame 中价格和面积字段为浮点数，楼层字段为整数。
- **测试步骤**：
  1. 调用 `process_price(price_str)`、`process_area(area_str)` 和 `process_floor(floor_str)` 函数。
  2. 检查清洗后的字段类型是否正确。
- **测试结果**：
  - 成功：字段类型正确，清洗结果符合预期。
  - 失败：字段类型错误或清洗结果异常。

#### 4.2.2 测试用例：验证数据可视化功能
- **测试目标**：验证生成的可视化图表是否符合预期。
- **输入**：清洗后的 DataFrame。
- **预期输出**：生成的品牌词云图、区域房源分布图、租金性价比图等图表。
- **测试步骤**：
  1. 调用 `data_visualize(df)` 函数。
  2. 检查生成的图表是否完整且无错误。
  3. 验证图表内容是否与数据一致。
- **测试结果**：
  - 成功：图表完整且内容正确。
  - 失败：图表缺失或内容错误。

### 4.3 性能测试

#### 4.3.1 测试用例：验证爬虫性能
- **测试目标**：验证爬虫在多页爬取时的响应时间和资源占用。
- **输入**：链家网租房页面 URL，爬取页数为 50 页。
- **预期输出**：爬取完成时间不超过 10 分钟，系统资源占用正常。
- **测试步骤**：
  1. 运行 `LianjiaRentSpider.py`，设置爬取页数为 50 页。
  2. 记录爬取完成时间。
  3. 监控系统资源占用情况。
- **测试结果**：
  - 成功：爬取完成时间在预期范围内，资源占用正常。
  - 失败：爬取时间过长或资源占用过高。

#### 4.3.2 测试用例：验证数据分析性能
- **测试目标**：验证数据分析与可视化模块的运行时间。
- **输入**：包含 1000 条房源信息的数据库文件。
- **预期输出**：数据分析与可视化完成时间不超过 5 分钟。
- **测试步骤**：
  1. 运行 `Data_Visualization.py`。
  2. 记录数据分析与可视化完成时间。
- **测试结果**：
  - 成功：运行时间在预期范围内。
  - 失败：运行时间过长。

## 5. 测试结果记录

### 5.1 数据爬取模块测试结果
| 测试用例       | 测试结果 | 备注                 |
| -------------- | -------- | -------------------- |
| 4.1.1          | 成功     | 返回非空 HTML 内容   |
| 4.1.2          | 成功     | 返回非空房源信息列表 |
| 4.1.3          | 成功     | 数据正确存储到数据库 |

### 5.2 数据分析与可视化模块测试结果
| 测试用例       | 测试结果 | 备注                       |
| -------------- | -------- | -------------------------- |
| 4.2.1          | 成功     | 字段类型正确，清洗结果符合预期 |
| 4.2.2          | 成功     | 图表完整且内容正确         |

### 5.3 性能测试结果
| 测试用例       | 测试结果 | 备注                           |
| -------------- | -------- | ------------------------------ |
| 4.3.1          | 成功     | 爬取 50 页数据耗时 8 分钟，资源占用正常 |
| 4.3.2          | 成功     | 数据分析与可视化耗时 3 分钟     |

## 6. 缺陷与问题

### 6.1 已发现缺陷
- **问题描述**：在某些情况下，`parse_page_content(html)` 函数可能会因页面结构变化导致解析失败。
- **解决方案**：增加异常处理机制，记录失败的页面并尝试重新解析。
- **状态**：已修复

- **问题描述**：在数据量较大时，`data_visualize(df)` 函数生成图表的速度较慢。
- **解决方案**：优化数据处理逻辑，减少不必要的计算。
- **状态**：已优化

### 6.2 未解决的问题
- **问题描述**：链家网的反爬机制可能会导致爬虫被封禁。
- **解决方案**：增加代理服务器支持，降低被封禁的风险。
- **状态**：待实现

## 7. 测试结论
经过全面的测试，`LianjiaRentSpider.py` 和 `Data_Visualization.py` 的功能符合设计需求，系统在正常情况下能够稳定运行。数据爬取模块能够正确请求和解析网页内容，并将数据存储到数据库中。数据分析与可视化模块能够正确处理数据，并生成直观的图表。性能测试表明，系统在高负载情况下仍能保持良好的性能。

尽管存在一些已解决的缺陷和未解决的问题，但整体系统已经具备上线运行的条件。建议在后续版本中继续优化性能，并增加对反爬机制的应对措施。
