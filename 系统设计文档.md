# 系统设计文档

---

## 1. 引言

本系统旨在设计一个网络爬虫，用于爬取链家网租房房源信息，并将数据存储到SQLite数据库中，同时结合数据分析和可视化技术，对爬取的数据进行统计分析，并以图表形式展示结果，为用户提供全面的租房市场视察，帮助用户更好地理解租房市场的分布、价格趋势和特征。系统分为四个核心模块：**爬虫模块**、**数据存储模块**、**数据处理模块**和**可视化分析模块**。本文档详细阐述系统的架构设计、数据库设计、功能模块设计、系统运行环境以及安全合规等。

---

## 2. 系统架构设计

### 2.1 整体架构

系统采用分层架构，分为以下层级：

1. **数据采集层**：通过爬虫获取链家网租房数据。
2. **数据存储层**：使用SQLite数据库持久化存储数据。
3. **数据处理层**：清洗和预处理原始数据。
4. **应用层**：提供数据可视化及分析功能。

### 2.2 技术选型

- **编程语言**：Python 3.x
- **爬虫库**：`requests`、`BeautifulSoup`
- **数据库**：SQLite
- **数据处理**：`pandas`、`re`
- **可视化**：`matplotlib`、`seaborn`、`WordCloud`

---

## 3. 数据库设计

### 3.1 表结构设计

表名：`rentals`，字段如下：

| 字段名          | 类型    | 描述               |
|-----------------|---------|--------------------|
| id              | INTEGER | 主键，自增         |
| title           | TEXT    | 房源标题           |
| lease_type      | TEXT    | 租赁类型（独栋/整租/合租）|
| location        | TEXT    | 房源位置（区域-地带）|
| name            | TEXT    | 小区名称           |
| area            | TEXT    | 面积               |
| price           | TEXT    | 月租金             |
| style           | TEXT    | 户型               |
| orientation     | TEXT    | 朝向               |
| floor           | TEXT    | 楼层               |
| decoration      | TEXT    | 装修情况           |
| transportation  | TEXT    | 交通便利性         |
| pay_type        | TEXT    | 押付方式           |
| first_rent      | TEXT    | 首次出租           |
| brand           | TEXT    | 房源品牌           |
| link            | TEXT    | 房源详情页链接     |

### 3.2 数据关系

- 所有字段均与单条房源记录直接关联，无外键依赖。
- 主键`id`确保数据唯一性。

### 3.3 数据库操作
- 创建数据库和表：setup_database()函数。
- 插入数据：save_to_database()函数。
- 读取数据：通过pandas.read_sql_query()读取数据。
---

## 4. 功能模块设计

### 4.1 爬虫模块

- **功能**：爬取链家租房列表页，解析房源信息。
- **流程**：
  - **step1**. 初始化数据库连接。
  - **step2**. 遍历链家网租房页面（分页处理）。
  - **step3**. 请求页面内容，解析HTML。
  - **step4**. 提取房源信息并存储到数据库。
  - **step5**. 设置请求间隔，避免触发反爬机制。
- **实现**：
  - 使用`requests`发送HTTP请求，设置`User-Agent`模拟浏览器。
  - 通过`BeautifulSoup`解析HTML，提取标题、价格、位置等字段。
  - 异常处理：捕获网络请求失败或解析错误，记录日志。
- **优化**：
  - 分页爬取（根据页面标号自定义爬取页面编号和爬取数量）。
  - 设置`time.sleep(2)`，每完成单页爬取时设置一定时延，避免触发反爬机制。

### 4.2 数据存储模块

- **功能**：将爬取数据持久化到SQLite数据库。
- **实现**：
  - 使用`sqlite3`库创建数据库及表结构。
  - 数据插入采用`INSERT OR IGNORE`语句，避免重复。
- **性能**：
  - 批量插入（`executemany`）提升写入效率。

### 4.3 数据处理模块

- **功能**：从数据库读取数据，清洗和转换原始数据。
- **实现**：、
  - **价格清洗**：提取数值并去除单位（`元`），处理范围值（如`6615-7020`）为平均值。
  - **面积清洗**：提取数值并去除单位（`㎡`），处理范围值（如`48.00-68.00`）为平均值。
  - **楼层清洗**：正则提取楼层数字（如`高楼层（6层）`→`6`）。
  - **添加新字段**：根据租金和面积计算单位租金（price_per_area）。
- **异常处理**：过滤无效数据（`dropna`）。
- **工具**：使用pandas进行数据预处理。

### 4.4 可视化分析模块

- **功能**：生成图表展示数据分布及关联。
- **实现**：
  - **词云图**：展示品牌分布。
  - **箱线图**：分析价格与区域、装修、朝向、楼层、交通、品牌等因素的关系。
  - **饼状图**：展示不同区域的房屋数量占比。
  - **条形图**：分析单位租金最低的房源排名以及平均租金最低的品牌排名等。
  - **热力图**：展示区域与装修情况的租金性价比。
- **工具**：使用`matplotlib`、`seaborn`、`WordCloud`进行数据可视化。

---

## 5. 系统运行环境

### 5.1 开发环境
- **操作系统**：Windows 11
- **Python版本**：Python 3.11.8
- **依赖库**：requests、beautifulsoup4、sqlite3、pandas、matplotlib、seaborn、wordcloud

### 5.2 运行环境
- Python环境配置完成即可运行。

---


## 6. 安全与合规

- **合规性**：遵守链家网的`robots.txt`协议，控制爬取频率。
- **数据安全**：数据库文件加密存储，避免敏感信息泄露。

---


