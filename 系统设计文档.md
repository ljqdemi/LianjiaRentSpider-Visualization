# 系统设计文档

---

## 1. 引言

本系统旨在通过爬取链家网的租房数据，结合数据分析和可视化技术，为用户提供全面的租房市场洞察。系统分为四个核心模块：**网页爬取模块**、**数据存储模块**、**数据处理模块**和**可视化分析模块**。本文档详细阐述系统的架构设计、功能模块实现及技术选型。

---

## 2. 系统架构设计

### 2.1 整体架构

系统采用分层架构，分为以下层级：

1. **数据采集层**：通过爬虫获取链家网租房数据。
2. **数据存储层**：使用SQLite数据库持久化存储数据。
3. **数据处理层**：清洗和预处理原始数据。
4. **应用层**：提供数据可视化及分析功能。

### 2.2 技术选型

- **编程语言**：Python 3.x
- **爬虫库**：`requests`、`BeautifulSoup`
- **数据库**：SQLite
- **数据处理**：`pandas`、`re`
- **可视化**：`matplotlib`、`seaborn`、`WordCloud`

---

## 3. 数据库设计

### 3.1 表结构设计

表名：`rentals`，字段如下：

| 字段名          | 类型    | 描述               |
|-----------------|---------|--------------------|
| id              | INTEGER | 主键，自增         |
| title           | TEXT    | 房源标题           |
| lease_type      | TEXT    | 租赁类型（整租/合租）|
| location        | TEXT    | 房源位置（区域-小区）|
| name            | TEXT    | 小区名称           |
| area            | TEXT    | 面积               |
| price           | TEXT    | 月租金             |
| style           | TEXT    | 户型               |
| orientation     | TEXT    | 朝向               |
| floor           | TEXT    | 楼层               |
| decoration      | TEXT    | 装修情况           |
| transportation  | TEXT    | 交通便利性         |
| pay_type        | TEXT    | 押付方式           |
| first_rent      | TEXT    | 首次出租           |
| brand           | TEXT    | 房源品牌           |
| link            | TEXT    | 房源详情页链接     |

### 3.2 数据关系

- 所有字段均与单条房源记录直接关联，无外键依赖。
- 主键`id`确保数据唯一性，`link`字段用于避免重复插入。

---

## 4. 功能模块设计

### 4.1 网页爬取模块

- **功能**：爬取链家租房列表页，解析房源信息。
- **实现**：
  - 使用`requests`发送HTTP请求，设置`User-Agent`模拟浏览器。
  - 通过`BeautifulSoup`解析HTML，提取标题、价格、位置等字段。
  - 异常处理：捕获网络请求失败或解析错误，记录日志。
- **优化**：
  - 设置`time.sleep(2)`避免触发反爬机制。
  - 分页爬取（示例代码中爬取前2页）。

### 4.2 数据存储模块

- **功能**：将爬取数据持久化到SQLite数据库。
- **实现**：
  - 使用`sqlite3`库创建数据库及表结构。
  - 数据插入采用`INSERT OR IGNORE`语句，避免重复。
- **性能**：
  - 批量插入（`executemany`）提升写入效率。

### 4.3 数据处理模块

- **功能**：清洗和转换原始数据。
- **实现**：
  - **价格清洗**：处理范围值（如`6615-7020`）为平均值。
  - **面积清洗**：提取数值并转换单位（`㎡`）。
  - **楼层清洗**：正则提取楼层数字（如`高楼层（6层）`→`6`）。
- **异常处理**：过滤无效数据（`dropna`）。

### 4.4 可视化分析模块

- **功能**：生成图表展示数据分布及关联。
- **实现**：
  - **词云图**：展示品牌分布。
  - **箱线图**：分析价格与区域、装修等因素的关系。
  - **热力图**：区域与装修情况的租金性价比。
- **工具**：`matplotlib`、`seaborn`、`WordCloud`。

---

## 5. 扩展性与优化

- **爬虫扩展**：支持动态代理IP池、多线程爬取。
- **数据库扩展**：迁移至MySQL或PostgreSQL以支持高并发。
- **可视化优化**：集成Web框架（如Flask）提供交互式图表。

---

## 6. 安全与合规

- **合规性**：遵守链家网的`robots.txt`协议，控制爬取频率。
- **数据安全**：数据库文件加密存储，避免敏感信息泄露。

---
